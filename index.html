<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Imagen Flotante AR - Realidad Aumentada</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body, html {
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            background: transparent;
            font-family: 'Courier New', monospace;
        }
        
        a-scene {
            background: transparent !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        .ar-overlay {
            position: fixed;
            top: 20px;
            left: 20px;
            color: #00ffff;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px 20px;
            border-radius: 12px;
            z-index: 1000;
            border: 2px solid #00ffff;
            backdrop-filter: blur(15px);
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
            max-width: 280px;
        }
        
        .ar-status {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            font-weight: bold;
            font-size: 14px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: #00ff00;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px #00ff00;
        }
        
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.3); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .ar-instructions {
            font-size: 11px;
            color: #aaaaaa;
            line-height: 1.5;
        }
        
        .ar-frame {
            position: fixed;
            width: 50px;
            height: 50px;
            border: 3px solid #00ffff;
            pointer-events: none;
            z-index: 999;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
        }
        
        .ar-frame.top-left {
            top: 15px;
            left: 15px;
            border-right: none;
            border-bottom: none;
        }
        
        .ar-frame.top-right {
            top: 15px;
            right: 15px;
            border-left: none;
            border-bottom: none;
        }
        
        .ar-frame.bottom-left {
            bottom: 15px;
            left: 15px;
            border-right: none;
            border-top: none;
        }
        
        .ar-frame.bottom-right {
            bottom: 15px;
            right: 15px;
            border-left: none;
            border-top: none;
        }
        
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: #00ffff;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }
        
        .spinner {
            border: 4px solid rgba(0, 255, 255, 0.3);
            border-top: 4px solid #00ffff;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            animation: glow 2s ease-in-out infinite alternate;
        }
        
        @keyframes glow {
            from { text-shadow: 0 0 10px #00ffff; }
            to { text-shadow: 0 0 20px #00ffff, 0 0 30px #00ffff; }
        }
        
        .error-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 0, 0, 0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            z-index: 1001;
            display: none;
            max-width: 300px;
            border: 2px solid #ff0000;
        }
        
        .crosshair {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            border: 2px solid #00ffff;
            border-radius: 50%;
            pointer-events: none;
            z-index: 998;
            opacity: 0.7;
            animation: crosshairPulse 3s infinite;
        }
        
        .crosshair::before,
        .crosshair::after {
            content: '';
            position: absolute;
            background: #00ffff;
        }
        
        .crosshair::before {
            width: 2px;
            height: 10px;
            top: -5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .crosshair::after {
            width: 10px;
            height: 2px;
            top: 50%;
            left: -5px;
            transform: translateY(-50%);
        }
        
        @keyframes crosshairPulse {
            0%, 100% { opacity: 0.7; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
        }
        
        @media (max-width: 768px) {
            .ar-overlay {
                top: 10px;
                left: 10px;
                right: 10px;
                max-width: none;
                padding: 12px;
            }
            
            .ar-frame {
                width: 35px;
                height: 35px;
                border-width: 2px;
            }
            
            .ar-instructions {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Pantalla de carga -->
    <div id="loadingScreen" class="loading-screen">
        <div class="spinner"></div>
        <div class="loading-text">INICIALIZANDO REALIDAD AUMENTADA...</div>
        <div style="font-size: 12px; margin-top: 10px; opacity: 0.7;">Cargando recursos 3D...</div>
    </div>

    <!-- Overlay de informaci√≥n AR -->
    <div class="ar-overlay">
        <div class="ar-status">
            <div class="status-dot"></div>
            <span>REALIDAD AUMENTADA ACTIVA</span>
        </div>
        <div class="ar-instructions">
            üñ±Ô∏è Arrastra para rotar la vista<br>
            üîç Scroll para hacer zoom<br>
            üì± WASD o flechas para moverte<br>
            üéØ R = Reset | F = Enfocar<br>
            üëÜ Click en imagen para interactuar
        </div>
    </div>

    <!-- Marcos de esquina AR -->
    <div class="ar-frame top-left"></div>
    <div class="ar-frame top-right"></div>
    <div class="ar-frame bottom-left"></div>
    <div class="ar-frame bottom-right"></div>

    <!-- Crosshair central -->
    <div class="crosshair"></div>

    <!-- Mensaje de error -->
    <div id="errorMessage" class="error-message">
        ‚ö†Ô∏è Error al cargar la imagen principal. Usando imagen de respaldo.
    </div>

    <!-- Escena A-Frame con AR.js -->
    <a-scene 
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true; alpha: true"
        arjs="sourceType: webcam; sourceWidth: 1280; sourceHeight: 720; displayWidth: 1280; displayHeight: 720; debugUIEnabled: false; cameraParametersUrl: https://raw.githubusercontent.com/jeromeetienne/ar.js/master/data/data/camera_para.dat"
        embedded>

        <!-- C√°mara AR -->
        <a-entity camera></a-entity>

        <!-- Assets -->
        <a-assets>
            <img id="mainTexture" src="https://scontent.fmdz7-1.fna.fbcdn.net/v/t39.30808-6/474838171_9426793647351680_1267474936689448151_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=6ee11a&_nc_eui2=AeHMggktZZoWIXOTp4f6gY3K4LTsvs0kb8LgtOy-zSRvwmz3XHNgyBv8fnH8HFv3auaTkhrHrRHdGisnYQSDwobf&_nc_ohc=1wv8ifHe1eoQ7kNvwEJA8JC&_nc_oc=AdkXJtlpW_RdhzORx_Jd05QJPX5o7j-8S4Glxg-LUUssuF2Dk_Y8VeJbpvSawXMJ2o2N0WaXK-qek24qgpCbdJao&_nc_zt=23&_nc_ht=scontent.fmdz7-1.fna&_nc_gid=TZLJQes6eNpbb69H8uY-rA&oh=00_AfXIFlKG-QyQd8Ph0kji0gT_6u8W0SGah0co2b4eP1DRPA&oe=689AA553" crossorigin="anonymous">
            <img id="fallbackTexture" src="https://scontent.fmdz7-1.fna.fbcdn.net/v/t39.30808-6/474838171_9426793647351680_1267474936689448151_n.jpg?_nc_cat=100&ccb=1-7&_nc_sid=6ee11a&_nc_eui2=AeHMggktZZoWIXOTp4f6gY3K4LTsvs0kb8LgtOy-zSRvwmz3XHNgyBv8fnH8HFv3auaTkhrHrRHdGisnYQSDwobf&_nc_ohc=1wv8ifHe1eoQ7kNvwEJA8JC&_nc_oc=AdkXJtlpW_RdhzORx_Jd05QJPX5o7j-8S4Glxg-LUUssuF2Dk_Y8VeJbpvSawXMJ2o2N0WaXK-qek24qgpCbdJao&_nc_zt=23&_nc_ht=scontent.fmdz7-1.fna&_nc_gid=TZLJQes6eNpbb69H8uY-rA&oh=00_AfXIFlKG-QyQd8Ph0kji0gT_6u8W0SGah0co2b4eP1DRPA&oe=689AA553" crossorigin="anonymous">
        </a-assets>

        <!-- Imagen principal flotante con animaciones mejoradas -->
        <a-image 
            id="mainImage"
            src="#mainTexture"
            transparent="true"
            alpha-test="0.05"
            position="0 0.5 -1"
            width="0.8"
            height="0.8"
            material="transparent: true; alphaTest: 0.05; side: double; shader: standard"
            animation__float="property: position; to: 0 0.8 -1; dir: alternate; loop: true; dur: 5000; easing: easeInOutSine"
            animation__rotate="property: rotation; to: 0 360 0; loop: true; dur: 25000; easing: linear"
            animation__scale="property: scale; to: 1.2 1.2 1.2; dir: alternate; loop: true; dur: 4000; easing: easeInOutSine"
            animation__wobble="property: rotation; to: 8 0 8; dir: alternate; loop: true; dur: 7000; easing: easeInOutSine"
            shadow="receive: false; cast: true"
            class="interactive">
        </a-image>

        <!-- Anillo hologr√°fico principal -->
        <a-ring 
            position="0 0.3 -1"
            radius-inner="0.6"
            radius-outer="0.7"
            color="#00ffff"
            material="transparent: true; opacity: 0.5; side: double; shader: standard"
            rotation="-90 0 0"
            animation__glow="property: material.opacity; to: 0.9; dir: alternate; loop: true; dur: 2500; easing: easeInOutSine"
            animation__spin="property: rotation; to: -90 360 0; loop: true; dur: 18000; easing: linear">
        </a-ring>

        <!-- Anillo hologr√°fico secundario -->
        <a-ring 
            position="0 0.3 -1"
            radius-inner="0.8"
            radius-outer="0.9"
            color="#ffffff"
            material="transparent: true; opacity: 0.2; side: double"
            rotation="-90 0 0"
            animation__glow2="property: material.opacity; to: 0.4; dir: alternate; loop: true; dur: 3000; easing: easeInOutSine"
            animation__spin2="property: rotation; to: -90 -360 0; loop: true; dur: 12000; easing: linear">
        </a-ring>

        <!-- Part√≠culas ambientales -->
        <a-entity 
            position="0 0.5 -1"
            particle-system="preset: snow; color: #00ffff, #ffffff, #88ccff; particleCount: 100; size: 0.1, 0.3; maxAge: 12; accelerationValue: 0 -0.02 0; velocityValue: 0 0 0; accelerationSpread: 1 0 1; velocitySpread: 0.5 0.5 0.5">
        </a-entity>

        <!-- Efectos de luz mejorados -->
        <a-entity 
            light="type: ambient; color: #505050; intensity: 0.7">
        </a-entity>
        
        <a-entity 
            light="type: directional; color: #ffffff; intensity: 1.8; castShadow: true" 
            position="2 3 1"
            shadow="type: pcfSoft; mapSize: 2048 2048; bias: -0.0001">
        </a-entity>
        
        <a-entity 
            light="type: point; color: #00ffff; intensity: 1.2; distance: 5; decay: 1" 
            position="1 1 -0.5"
            animation__pulse="property: light.intensity; to: 1.8; dir: alternate; loop: true; dur: 2500; easing: easeInOutSine">
        </a-entity>

        <a-entity 
            light="type: point; color: #ff88cc; intensity: 0.8; distance: 4; decay: 1" 
            position="-1 0.5 -1.5"
            animation__pulse2="property: light.intensity; to: 1.2; dir: alternate; loop: true; dur: 3500; easing: easeInOutSine">
        </a-entity>

        <!-- Texto de error (oculto por defecto) -->
        <a-text 
            id="errorText"
            value="‚ö†Ô∏è IMAGEN DE RESPALDO CARGADA\nLa imagen principal no pudo cargarse"
            position="0 0.2 -1"
            align="center"
            color="#ff4444"
            width="2"
            visible="false"
            material="transparent: true; opacity: 0.9"
            animation__blink="property: material.opacity; to: 0.4; dir: alternate; loop: true; dur: 1500; easing: easeInOutSine">
        </a-text>
    </a-scene>

    <script>
        // Variables globales
        let imageLoaded = false;
        let fallbackUsed = false;

        // Configuraci√≥n inicial
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Iniciando sistema de Realidad Aumentada...');
            
            const scene = document.querySelector('a-scene');
            const loadingScreen = document.getElementById('loadingScreen');
            const mainImage = document.getElementById('mainImage');
            const errorText = document.getElementById('errorText');
            const errorMessage = document.getElementById('errorMessage');
            
            // Configurar renderer para transparencia perfecta
            scene.addEventListener('loaded', function() {
                console.log('üé¨ Escena A-Frame cargada');
                
                // Ocultar pantalla de carga con efecto
                setTimeout(() => {
                    loadingScreen.style.opacity = '0';
                    loadingScreen.style.transition = 'opacity 1s ease-out';
                    setTimeout(() => {
                        loadingScreen.style.display = 'none';
                    }, 1000);
                }, 2500);
            });

            // Manejo de carga exitosa de imagen
            mainImage.addEventListener('materialtextureloaded', function() {
                console.log('‚úÖ Imagen principal cargada correctamente');
                imageLoaded = true;
                
                // Configurar material para transparencia
                if (this.object3D && this.object3D.children[0]) {
                    const material = this.object3D.children[0].material;
                    material.transparent = true;
                    material.alphaTest = 0.05;
                    material.needsUpdate = true;
                }
            });

            // Manejo de errores de imagen
            mainImage.addEventListener('error', function() {
                console.warn('‚ùå Error al cargar imagen principal');
                handleImageError(this);
            });

            // Verificar carga de imagen despu√©s de un tiempo
            setTimeout(() => {
                if (!imageLoaded && !fallbackUsed) {
                    console.warn('‚è∞ Timeout de carga, usando imagen de respaldo');
                    handleImageError(mainImage);
                }
            }, 5000);

            // Funci√≥n para manejar errores de imagen
            function handleImageError(imageElement) {
                if (fallbackUsed) return; // Evitar bucle infinito
                
                fallbackUsed = true;
                console.log('üîÑ Cambiando a imagen de respaldo...');
                
                // Cambiar a imagen de respaldo
                imageElement.setAttribute('src', '#fallbackTexture');
                imageElement.setAttribute('material', 'transparent: true; alphaTest: 0.1; side: double');
                
                // Mostrar mensajes de error
                errorText.setAttribute('visible', 'true');
                errorMessage.style.display = 'block';
                
                // Ocultar mensaje de error despu√©s de 8 segundos
                setTimeout(() => {
                    errorText.setAttribute('visible', 'false');
                    errorMessage.style.display = 'none';
                }, 8000);
            }

            // Efectos de interactividad mejorados
            mainImage.addEventListener('click', function() {
                console.log('üëÜ Click en imagen detectado');
                
                // Efecto de click - escala y rotaci√≥n
                this.setAttribute('animation__click', 'property: scale; to: 1.4 1.4 1.4; dur: 300; easing: easeOutElastic');
                this.setAttribute('animation__clickRotate', 'property: rotation; to: 0 90 0; dur: 300; easing: easeOutQuad');
                
                setTimeout(() => {
                    this.removeAttribute('animation__click');
                    this.removeAttribute('animation__clickRotate');
                }, 300);
                
                // Efecto de part√≠culas en click
                createClickEffect(this.getAttribute('position'));
            });

            // Efectos de hover
            mainImage.addEventListener('mouseenter', function() {
                this.setAttribute('animation__hover', 'property: material.opacity; to: 0.8; dur: 400; easing: easeInOutQuad');
                document.body.style.cursor = 'pointer';
            });

            mainImage.addEventListener('mouseleave', function() {
                this.setAttribute('animation__hover', 'property: material.opacity; to: 1.0; dur: 400; easing: easeInOutQuad');
                document.body.style.cursor = 'default';
            });

            // Funci√≥n para crear efecto de part√≠culas en click
            function createClickEffect(position) {
                const clickEffect = document.createElement('a-entity');
                clickEffect.setAttribute('position', position);
                clickEffect.setAttribute('particle-system', 
                    'preset: default; color: #00ffff, #ffffff; particleCount: 30; size: 0.05, 0.2; maxAge: 2; accelerationValue: 0 2 0; velocityValue: 0 0 0; accelerationSpread: 2 2 2'
                );
                
                scene.appendChild(clickEffect);
                
                // Remover efecto despu√©s de 3 segundos
                setTimeout(() => {
                    scene.removeChild(clickEffect);
                }, 3000);
            }

            // Informaci√≥n de debug y ayuda
            console.log('üìã CONTROLES DISPONIBLES:');
            console.log('   üñ±Ô∏è  Rat√≥n: Rotar vista');
            console.log('   üëÜ  Click en imagen: Efecto de interacci√≥n');
            console.log('‚ú® Sistema AR completamente inicializado');
        });

        // Manejo de errores globales
        window.addEventListener('error', function(e) {
            console.warn('‚ö†Ô∏è Error capturado:', e.message);
        });

        // Optimizaci√≥n para m√≥viles
        if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            console.log('üì± Dispositivo m√≥vil detectado - Aplicando optimizaciones');
            
            // Reducir calidad de part√≠culas en m√≥viles
            document.addEventListener('DOMContentLoaded', function() {
                const particles = document.querySelector('[particle-system]');
                if (particles) {
                    particles.setAttribute('particle-system', 'particleCount: 50');
                }
            });
        }

        // Solicitar permiso de c√°mara trasera
        function requestRearCamera() {
            if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                navigator.mediaDevices.enumerateDevices()
                    .then(devices => {
                        const videoDevices = devices.filter(device => device.kind === 'videoinput');
                        if (videoDevices.length > 1) {
                            console.log('üì∑ Dispositivos de c√°mara encontrados:', videoDevices);
                            
                            const constraints = {
                                video: {
                                    facingMode: { exact: "environment" },
                                    width: { ideal: 1280 },
                                    height: { ideal: 720 }
                                }
                            };
                            
                            navigator.mediaDevices.getUserMedia(constraints)
                                .then(stream => {
                                    console.log('‚úÖ C√°mara trasera activada');
                                })
                                .catch(err => {
                                    console.warn('‚ö†Ô∏è No se pudo acceder a la c√°mara trasera:', err);
                                    // Intentar con c√°mara frontal si la trasera falla
                                    fallbackToFrontCamera();
                                });
                        } else {
                            console.log('üì∑ Solo una c√°mara disponible, usando esa');
                            fallbackToFrontCamera();
                        }
                    })
                    .catch(err => {
                        console.warn('‚ö†Ô∏è Error al enumerar dispositivos:', err);
                        fallbackToFrontCamera();
                    });
            } else {
                console.warn('‚ö†Ô∏è API de dispositivos no soportada');
                fallbackToFrontCamera();
            }
        }

        function fallbackToFrontCamera() {
            const constraints = {
                video: {
                    facingMode: "user",
                    width: { ideal: 1280 },
                    height: { ideal: 720 }
                }
            };
            
            navigator.mediaDevices.getUserMedia(constraints)
                .then(stream => {
                    console.log('‚úÖ C√°mara frontal activada como respaldo');
                })
                .catch(err => {
                    console.error('‚ùå No se pudo acceder a ninguna c√°mara:', err);
                });
        }

        // Solicitar c√°mara al cargar
        document.addEventListener('DOMContentLoaded', requestRearCamera);

        // Mensaje de bienvenida
        setTimeout(() => {
            console.log('üéâ ¬°Bienvenido a la experiencia de Realidad Aumentada!');
            console.log('üí° Tip: Haz click en la imagen flotante para efectos especiales');
        }, 3000);
    </script>
</body>
</html>